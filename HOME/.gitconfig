# ============================================================
# Git Configuration
# ============================================================
[include]
    path = ~/.gitconfig.user
# [user]
# 	name = Shota Iuchi
# 	email = shotaiuchi.develop@gmail.com

# ============================================================
# Init
# ============================================================
[init]
    defaultBranch = main

# ============================================================
# Core Settings
# ============================================================
[core]
    pager = delta
    quotepath = false       ; 日本語ファイル名の文字化け防止
    filemode = false        ; パーミッション変更を無視
    autocrlf = false        ; 改行コード自動変換しない
    symlinks = true         ; シンボリックリンク対応
    commentChar = ";"       ; コメント文字を # から ; に変更

[color]
    ui = auto

# ============================================================
# Aliases
# ============================================================
[alias]
    ; ----------------------------------------------------------
    ; Information
    ; ----------------------------------------------------------
    aliass = config --get-regexp alias      ; エイリアス一覧
    me     = config --get-regexp user       ; ユーザー情報表示

    ; ----------------------------------------------------------
    ; Utility
    ; ----------------------------------------------------------
    cofirst = commit --allow-empty -m 'Initial commit'

    ; ----------------------------------------------------------
    ; Add
    ; ----------------------------------------------------------
    a  = add
    aa = add --all
    ap = add --patch        ; 対話的に部分追加
    au = add --update       ; 変更・削除のみ追加

    ; ----------------------------------------------------------
    ; Branch
    ; ----------------------------------------------------------
    b  = branch
    ba = branch --all

    ; ----------------------------------------------------------
    ; Log
    ; ----------------------------------------------------------
    l  = log --oneline -20
    ll = log --oneline
    lt = log --oneline --topo-order             ; ブランチの流れ順
    ld = log --oneline --author-date-order      ; 作業した時刻順

    ; ----------------------------------------------------------
    ; Reflog
    ; ----------------------------------------------------------
    rl  = "!f() { git reflog --color=always --format='%C(auto)%h %C(green)%gd %C(reset)- %gs %C(reset)| %s %C(blue)(%ci)%C(auto)%d%C(reset)' ${1:--20} | perl -pe 'BEGIN{$f=0} if($f){s/(- [^|]*)/\\e[1;32m$1\\e[0m/;$f=0} $f=1 if /rebase \\(start\\)/; s/ \\e\\[m\\|[^\\e]*(?=\\e\\[34m)/ / if /- (?:commit|rebase \\((?:pick|continue)\\)|cherry-pick)/; s/(reset: (?!moving to HEAD )[^|]*)/\\e[1;31m$1\\e[0m/g; s/(rebase \\(fixup\\)[^|]*)/\\e[1;33m$1\\e[0m/g; s/(rebase \\(reword\\)[^|]*)/\\e[1;33m$1\\e[0m/g; s/(rebase \\((?!pick|start|fixup|reword)[^)]*\\)[^|]*)/\\e[1;31m$1\\e[0m/g; s/(merge[^|]*)/\\e[1;35m$1\\e[0m/g; s/(checkout:[^|]*)/\\e[1;36m$1\\e[0m/g'; }; f"
    rll = "!git reflog --color=always --format='%C(auto)%h %C(green)%gd %C(reset)- %gs %C(reset)| %s %C(blue)(%ci)%C(auto)%d%C(reset)' | perl -pe 'BEGIN{$f=0} if($f){s/(- [^|]*)/\\e[1;32m$1\\e[0m/;$f=0} $f=1 if /rebase \\(start\\)/; s/ \\e\\[m\\|[^\\e]*(?=\\e\\[34m)/ / if /- (?:commit|rebase \\((?:pick|continue)\\)|cherry-pick)/; s/(reset: (?!moving to HEAD )[^|]*)/\\e[1;31m$1\\e[0m/g; s/(rebase \\(fixup\\)[^|]*)/\\e[1;33m$1\\e[0m/g; s/(rebase \\(reword\\)[^|]*)/\\e[1;33m$1\\e[0m/g; s/(rebase \\((?!pick|start|fixup|reword)[^)]*\\)[^|]*)/\\e[1;31m$1\\e[0m/g; s/(merge[^|]*)/\\e[1;35m$1\\e[0m/g; s/(checkout:[^|]*)/\\e[1;36m$1\\e[0m/g' | $(git var GIT_PAGER)"

    ; ----------------------------------------------------------
    ; Status
    ; ----------------------------------------------------------
    s = status

    ; ----------------------------------------------------------
    ; Checkout
    ; ----------------------------------------------------------
    c      = checkout
    cm     = checkout main
    cempty = checkout --orphan  ; 履歴なしブランチ作成

    ; ----------------------------------------------------------
    ; Commit
    ; ----------------------------------------------------------
    co   = commit
    com  = commit --message
    coa  = commit --amend
    coan = commit --amend --no-edit

    ; ----------------------------------------------------------
    ; Diff
    ; ----------------------------------------------------------
    d  = diff
    ds = diff --cached      ; ステージ済みの差分
    db = diff --stat        ; 統計情報のみ
    dd = !sh -c 'git diff ${1:-HEAD}~ ${1:-HEAD} $2 $3 $4 $5 $6 $7 $8 $9' -
    dn = !sh -c 'git diff --name-only ${1:-HEAD}~ ${1:-HEAD} $2 $3 $4 $5 $6 $7 $8 $9' -

    ; ----------------------------------------------------------
    ; State Change (ローカル状態変更)
    ; ----------------------------------------------------------
    unstage = reset HEAD --     ; ステージ取り消し
    pick    = cherry-pick

    ; ----------------------------------------------------------
    ; Server Change (リモート操作)
    ; ----------------------------------------------------------
    pushme  = !sh -c 'git push ${1:-origin} $2 $3 $4 $5 $6 $7 $8 $9 `git rev-parse --abbrev-ref HEAD`' -
    pushmef = !sh -c 'git push --force-with-lease ${1:-origin} $2 $3 $4 $5 $6 $7 $8 $9 `git rev-parse --abbrev-ref HEAD`' -

    ; ----------------------------------------------------------
    ; ⚠️  Destructive (破壊的操作 - 注意して使用)
    ; ----------------------------------------------------------
    fback   = !sh -c 'git reset --soft HEAD~${1:-1}' -  ; コミット取り消し(変更は保持)
    fclean  = "!f() { git reset --hard HEAD; git clean --force -d; }; f"
    faclean = "!f() { git reset --hard HEAD; git clean --force -d; git ls-files --others | xargs rm -rf; }; f"

    ; ----------------------------------------------------------
    ; GitHub PR
    ; ----------------------------------------------------------
    ghd = "!f() { args=''; if [ $# -eq 0 ]; then pr=$(gh pr list | fzf | awk '{print $1}' | tr -d '#'); [ -z \"$pr\" ] && return; args=\"$pr\"; elif [ \"$1\" != \".\" ]; then args=\"$@\"; fi; gh pr diff $args | eval \"$(git config core.pager || echo less)\"; }; f"

# ============================================================
# Pull / Fetch / Rebase
# ============================================================
[pull]
    rebase = true             ; pull時にmergeではなくrebase

[fetch]
    prune = true              ; fetch時に削除済みリモートブランチを自動削除

[rerere]
    enabled = false           ; コンフリクト解消を記憶して再利用

[rebase]
    autoStash = true          ; rebase前に自動stash、完了後に自動pop

# ============================================================
# Log
# ============================================================
[log]
    date = iso

# ============================================================
# ghq
# ============================================================
[ghq]
    root = ~/ghq

# ============================================================
# Delta (diff viewer)
# ============================================================
[interactive]
    diffFilter = delta --color-only
[delta]
    navigate = true
    side-by-side = false
    line-numbers = true
[merge]
    conflictstyle = diff3
[diff]
    colorMoved = default
